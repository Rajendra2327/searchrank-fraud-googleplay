<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <%@ include file="connect.jsp" %>
            <%@ page import="java.util.*"%>
            <%@ page import="java.text.*"%>
            <%@ page import="java.util.Date"%>
            <%@ page import="java.sql.*"%>
            <%@ page import="com.oreilly.servlet.*,java.lang.*,java.text.SimpleDateFormat,java.io.*,javax.servlet.*, javax.servlet.http.*" %>
            <%@ page import ="java.util.*,java.security.Key,java.util.Random,javax.crypto.Cipher,javax.crypto.spec.SecretKeySpec"%>
            <%@ page import="org.bouncycastle.util.encoders.Base64"%>
            <%@ page import="java.util.Random,java.io.PrintStream, java.io.FileOutputStream, java.io.FileInputStream, java.security.DigestInputStream, java.math.BigInteger, java.security.MessageDigest, java.io.BufferedInputStream" %>
<head>
<title>User Recommends</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/style.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="css/coin-slider.css" />
<script type="text/javascript" src="js/cufon-yui.js"></script>
<script type="text/javascript" src="js/cufon-times.js"></script>
<script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="js/script.js"></script>
<script type="text/javascript" src="js/coin-slider.min.js"></script>
<style type="text/css">
<!--
.style1 {
	color: #FF00FF;
	font-size: 36px;
}
-->
</style>
</head>
<body>
<div class="main">
  <div class="header">
    <div class="header_resize">
      <div class="logo">
        <h1><a href="index.html"><span class="style1">Search Rank Fraud and Malware Detection in Google Play</span></a></h1>
      </div>
      <div class="menu_nav">
        <ul>
         <li><a href="index.html"><span>Home Page</span></a></li>
          <li><a href="App_Login.jsp"><span>App Developer</span></a></li>
          <li><a href="S_Login.jsp"><span>Server</span></a></li>
          <li class="active"><a href="U_Login.jsp"><span>User</span></a></li>
        </ul>
      </div>
      <div class="clr"></div>
      <div class="slider">
        <div id="coin-slider"> <a href="#"><img src="images/slide1.jpg" width="960" height="360" alt="" /></a> <a href="#"><img src="images/slide2.jpg" width="960" height="360" alt="" /></a> <a href="#"><img src="images/slide3.jpg" width="960" height="360" alt="" /></a> </div>
        <div class="clr"></div>
      </div>
      <div class="clr"></div>
    </div>
  </div>
  <div class="content">
    <div class="content_resize">
      <div class="mainbar">
        <div class="article">
           <div class="article">
           <h2 align="center">  Recommended Status </h2>
        </div>
		<%
			try 
				{
	  					String type=request.getParameter("type");
						 String uname=(String)application.getAttribute("uname");
						 int one= Integer.parseInt(request.getParameter("id"));
						 String aname = request.getParameter("aname");
						 String count3=request.getParameter("k1");
							
	 String s1="",s2="",s3="",s4="",s5="",s6="",s7="",s8="",s9="",s10,s11,s12,s13,os;
	int i=0,j=0,rank1=0;
      String str="recommend";
	
			
								SimpleDateFormat sdfDate = new SimpleDateFormat("dd/MM/yyyy");
								SimpleDateFormat sdfTime = new SimpleDateFormat("HH:mm:ss");
		
								Date now = new Date();
		
									String strDate = sdfDate.format(now);
									String strTime = sdfTime.format(now);
									String dt = strDate + "   " + strTime;
	  
			
	String query1="select count,mtype,aname from search where id="+one+" and uname='"+uname+"' and dt='"+strDate+"' and type='"+str+"' group by id "; 
        Statement st1=connection.createStatement();
        ResultSet rs1=st1.executeQuery(query1);
	  if ( rs1.next()==true )//1
	   {
		int k=rs1.getInt(1);
		if(k>=3)
		{
			
			 s8=rs1.getString(2);
			 s9=rs1.getString(3);
			String ip_h = request.getRemoteAddr();  
			String host_h = request.getRemoteHost();  

			Statement st31 = connection.createStatement();
			String query31 ="insert into evidence values('"+uname+"','"+s8+"','"+s9+"',"+one+",'"+ip_h+"','"+host_h+"','"+dt+"','"+str+"')";
			st31.executeUpdate (query31); %>
			
			<b><p2>  <% out.println("You are Blocked for Missusing the Application By Recommending More Then 3 Times and you are Fraud Know..... :-) "); %></p2> </b>
			<p align="right"><a href="U_Main.jsp">Back</a></p>
	<%	}
	if(k<3)
		{
	
			String query2="select * from recommended  where aname='"+aname+"' and user='"+uname+"' "; 
			Statement st2=connection.createStatement();
			ResultSet rs2=st2.executeQuery(query2);
			if ( rs2.next()==true)
			   {
					String query="select id,rank from application where aname='"+ aname +"' "; 
           			Statement st=connection.createStatement();
        		   ResultSet rs=st.executeQuery(query);
					if ( rs.next() )
	 				  {
						i=rs.getInt(1);
						int rank=rs.getInt(2);

								 rank1=rank+1;
					 Statement st32 = connection.createStatement();
					 String query32 ="update application set rank="+rank1+" where aname='"+aname+"' ";
					 st32.executeUpdate (query32);
						
						Statement st3 = connection.createStatement();
		String query3 ="update search set count=count+1 where id="+one+" and uname='"+uname+"' and dt='"+strDate+"' and type='"+str+"' ";
		st3.executeUpdate (query3);
						
				%>
          <br/>
          <p align="center" class="style32 style18 style44"><strong>Application Details Already Recommended!!</strong></p>
          <br/>
          <p align="center"><a href="U_FoundApp.jsp?id=<%=i%>&type=<%=type%>&rank=<%=rank1%>" class="style11 style33 style28"><strong>Back</strong></a></p>
          <%
				}}
				else
				{
	
	
      		String query="select * from application where aname='"+ aname+"' "; 
           Statement st=connection.createStatement();
           ResultSet rs=st.executeQuery(query);
	if ( rs.next() )
	   {
		i=rs.getInt(1);
		s2=rs.getString(4);
		int rank=rs.getInt(9);
		os=rs.getString(3);
		rank1=rank+1;
		
	  
	  							
	  
	  					String query23="insert into recommended(aname,user,date) values('"+s2+"','"+uname+"','"+dt+"')"; 
								Statement st23=connection.createStatement();
								st23.executeUpdate(query23);
								
					
					 Statement st32 = connection.createStatement();
					 String query32 ="update application set rank="+rank1+" where aname='"+aname+"' ";
					 st32.executeUpdate (query32);
					
					
					 int count4=1;		
			Statement st31 = connection.createStatement();
			String query31 ="insert into search values('"+uname+"','"+os+"','"+aname+"',"+one+",'"+strDate+"','"+count4+"','"+str+"')";
			st31.executeUpdate (query31);
								
								
								
							%>
          <br/>
          <p align="center" class="style32 style18 style44"><strong>Application Details Recommended Successfully!!</strong></p>
          <br/>
          <p align="center"><a href="U_FoundApp.jsp?id=<%=i%>&type=<%=type%>&rank=<%=rank1%>"><strong>Back</strong></a></p>
          <%	
								
								
	  
	  }}
	  
	  }}
	  else
	  {
	  	
			String query2="select * from recommended  where aname='"+aname+"' and user='"+uname+"' "; 
			Statement st2=connection.createStatement();
			ResultSet rs2=st2.executeQuery(query2);
			if ( rs2.next()==true)
			   {
					String query="select id,rank,os from application where aname='"+ aname +"' "; 
           			Statement st=connection.createStatement();
        		   ResultSet rs=st.executeQuery(query);
					if ( rs.next() )
	 				  {
						i=rs.getInt(1);
						int rank=rs.getInt(2);
						os=rs.getString(3);

								 rank1=rank+1;
					 Statement st32 = connection.createStatement();
					 String query32 ="update application set rank="+rank1+" where aname='"+aname+"' ";
					 st32.executeUpdate (query32);
						
						 int count4=1;		
			Statement st31 = connection.createStatement();
			String query31 ="insert into search values('"+uname+"','"+os+"','"+aname+"',"+one+",'"+strDate+"','"+count4+"','"+str+"')";
			st31.executeUpdate (query31);
				%>
          <br/>
          <p align="center" class="style32 style18 style44"><strong>Application Details Already Recommended!!</strong></p>
          <br/>
          <p align="center"><a href="U_FoundApp.jsp?id=<%=i%>&type=<%=type%>&rank=<%=rank1%>" class="style11 style33 style28"><strong>Back</strong></a></p>
          <%
				}}
				else
				{
	
	
      		String query="select * from application where aname='"+ aname+"' "; 
           Statement st=connection.createStatement();
           ResultSet rs=st.executeQuery(query);
	if ( rs.next() )
	   {
		i=rs.getInt(1);
		s2=rs.getString(4);
		int rank=rs.getInt(9);
		os=rs.getString(3);
		
		rank1=rank+1;
		
	  
	  							
	  
	  					String query23="insert into recommended(aname,user,date) values('"+s2+"','"+uname+"','"+dt+"')"; 
								Statement st23=connection.createStatement();
								st23.executeUpdate(query23);
								
					
					 Statement st32 = connection.createStatement();
					 String query32 ="update application set rank="+rank1+" where aname='"+aname+"' ";
					 st32.executeUpdate (query32);
								
								 int count4=1;		
			Statement st31 = connection.createStatement();
			String query31 ="insert into search values('"+uname+"','"+os+"','"+aname+"',"+one+",'"+strDate+"','"+count4+"','"+str+"')";
			st31.executeUpdate (query31);
							%>
          <br/>
          <p align="center" class="style32 style18 style44"><strong>Application Details Recommended Successfully!!</strong></p>
          <br/>
          <p align="center"><a href="U_FoundApp.jsp?id=<%=i%>&type=<%=type%>&rank=<%=rank1%>"><strong>Back</strong></a></p>
          <%	
								
								
	  
	  }}
		
	  }
           connection.close();
          }
         
          catch(Exception e)
          {
            out.println(e.getMessage());
          }
%>
          </table>
		  
		  
		  
          <div class="clr"></div>
          <div class="clr"></div>
        </div>
        <div class="article">
          <p class="infopost">&nbsp;</p>
          <div class="clr"></div>
          <div class="clr"></div>
        </div>
        </div>
      <div class="sidebar">
        <div class="searchform">
          <form id="formsearch" name="formsearch" method="post" action="#">
            <span>
            <input name="editbox_search" class="editbox_search" id="editbox_search" maxlength="80" value="Search our ste:" type="text" />
            </span>
            <input name="button_search" src="images/search.gif" class="button_search" type="image" />
          </form>
        </div>
        <div class="clr"></div>
        <div class="gadget">
          <h2 class="star"><span>Sidebar</span> Menu</h2>
          <div class="clr"></div>
          <ul class="sb_menu">
            <li><a href="U_Main.jsp">Home</a></li>
            <li><a href="U_Login.jsp">LogOut</a></li>
          </ul>
        </div>
      </div>
      <div class="clr"></div>
    </div>
  </div>
  <div class="fbg">
    <div class="fbg_resize">
      <div class="col c1">
        <h2><span>Image</span> Gallery</h2>
        <a href="#"><img src="images/gal1.jpg" width="75" height="75" alt="" class="gal" /></a> <a href="#"><img src="images/gal2.jpg" width="75" height="75" alt="" class="gal" /></a> <a href="#"><img src="images/gal3.jpg" width="75" height="75" alt="" class="gal" /></a> <a href="#"><img src="images/gal4.jpg" width="75" height="75" alt="" class="gal" /></a> <a href="#"><img src="images/gal5.jpg" width="75" height="75" alt="" class="gal" /></a> <a href="#"><img src="images/gal6.jpg" width="75" height="75" alt="" class="gal" /></a> </div>
      <div class="clr"></div>
    </div>
  </div>
  <div class="footer"></div>
</div>
<div align=center></div>
</body>
</html>
